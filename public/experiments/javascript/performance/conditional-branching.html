<html>
<head>
    <title>JavaScript Conditional Branching Test</title>
</head>
<body>  
    <h1>JavaScript Conditional Branching Test</h1>
    <p>The purpose of this page is to determine the performance issues related to conditional
    branching in JavaScript. Conditional branching can be accomplished using <code>if</code> statements,
    <code>switch</code> statements, or array lookup. The tests on this page run through a series of
    conditional branches to determine which is fastest in each situation. The tests are run multiple times
    and the average is reported.</p>
    <p>The tests may take several minutes to fully execute 
    but should not crash the browser.</p>
    <p>Back to <a href="/">my site</a>.</p>
    
    <p>Run each test 
    <select id="var-accesses">
        <option value="50000">50,000</option>
        <option value="100000">100,000</option>
        <option value="200000">200,000</option>
        <option value="300000">300,000</option>
        <option value="400000">400,000</option>
        <option value="500000">500,000</option>
    </select> times<br />
    <input type="button" id="run-tests" value="Run Tests" /></p>
    <div id="progress" style="font-style: italic"></div>
    <div id="results"><h2>Results</h2></div>
    <script>

//function used to test if statement
function testIf(value){
    var result = "hello";
    if (value == 0){
        return result;
    } else if (value == 1){
        return result;
    } else if (value == 2){
        return result;
    } else if (value == 3){
        return result;
    } else if (value == 4){
        return result;
    } else if (value == 5){
        return result;
    } else if (value == 6){
        return result;
    } else if (value == 7){
        return result;
    } else if (value == 8){
        return result;
    } else if (value == 9){
        return result;
    } else {
        return result;
    }
} 

//function used to test switch statement
function testSwitch(value){
    var result = "hello";
    switch(value){
        case 0:
            return result;
        case 1:
            return result;
        case 2:
            return result;
        case 3:
            return result;
        case 4:
            return result;
        case 5:
            return result;
        case 6:
            return result;
        case 7:
            return result;
        case 8:
            return result;
        case 9:
            return result;
        default:
            return result;            
    }
}  

//used to test array lookup
var results = ["hello","hello","hello","hello","hello","hello","hello","hello","hello","hello","hello"];
function testArrayLookup(value){
    return results[value];
} 

var global=1,           //global variable to access
    runs = 100000,      //number of times to run the tests
    curTest = null,     //the currently executing test
    results = [],       //results of each run
    
    
//-----------------------------------------------------------------------------
// Tests
//-----------------------------------------------------------------------------
    tests = [
        {
            name: "Empty loop time",
            test: function(){
                var i=0, start,stop;
                start = new Date();
                for (; i < runs; i++){
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "If statement (0)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testIf(0);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "If statement (1)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testIf(1);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "If statement (2)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testIf(2);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "If statement (3)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testIf(3);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "If statement (4)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testIf(4);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "If statement (5)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testIf(5);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "If statement (6)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testIf(6);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "If statement (7)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testIf(7);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "If statement (8)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testIf(8);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "If statement (9)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testIf(9);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "If statement (10)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testIf(10);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Switch statement (0)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testSwitch(0);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Switch statement (1)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testSwitch(1);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Switch statement (2)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testSwitch(2);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Switch statement (3)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testSwitch(3);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Switch statement (4)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testSwitch(4);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Switch statement (5)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testSwitch(5);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Switch statement (6)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testSwitch(6);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Switch statement (7)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testSwitch(7);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Switch statement (8)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testSwitch(8);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Switch statement (9)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testSwitch(9);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Switch statement (10)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testSwitch(10);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Array Lookup (0)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testArrayLookup(0);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Array Lookup (1)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testArrayLookup(1);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Array Lookup (2)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testArrayLookup(2);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Array Lookup (3)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testArrayLookup(3);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Array Lookup (4)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testArrayLookup(4);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Array Lookup (5)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testArrayLookup(5);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Array Lookup (6)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testArrayLookup(6);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Array Lookup (7)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testArrayLookup(7);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Array Lookup (8)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testArrayLookup(8);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Array Lookup (9)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testArrayLookup(9);
                }
                stop = new Date();
                return stop-start;
            }
        },
        {
            name: "Array Lookup (10)",
            test: function (){
                var i=0, start,stop,local;
                start = new Date();
                for (; i < runs; i++){
                    local = testArrayLookup(10);
                }
                stop = new Date();
                return stop-start;
            }
        }                              

    ];

//-----------------------------------------------------------------------------
// Test Execution
//-----------------------------------------------------------------------------

window.onload = function(){

    document.getElementById("run-tests").onclick = function(){
        var totalTestCount = tests.length,
            curTestNum =1,
            progressElement = document.getElementById("progress"),
            accessSelector = document.getElementById("var-accesses");
            
        //get number of accesses
        runs = Number(accessSelector.options[accessSelector.selectedIndex].value);
        
        setTimeout(function(){
            
            curTest = tests.shift();
            if (curTest){
                results.push(curTest.test());
                
                progressElement.innerHTML = "Running tests (" + (curTestNum++) + "/" + totalTestCount + ")";
                        
                var outer = arguments.callee;
                setTimeout(function(){
                
                    results.push(curTest.test());
                    if (results.length < 100){
                        setTimeout(arguments.callee, 50);  //run again
                    } else {
                        var sum = 0;
                        for (var i=0; i < results.length; i++){
                            sum += results[i];
                        }
                        
                        document.getElementById("results").innerHTML += curTest.name + ": " + (sum/results.length) + "ms<br />";
                        results = [];
                        setTimeout(outer, 50);            
                    }
                }, 50);
        
            } else {
                progressElement.innerHTML = "All tests complete (" + totalTestCount + "/" + totalTestCount + ")";
            }
        }, 0);
    };
};

    </script>
    
</body>
</html>